# 2025-06-06-00-00

## [FlashMLA-ETAP: Efficient Transpose Attention Pipeline for Accelerating MLA Inference on NVIDIA H20 GPUs](https://arxiv.org/abs/2506.01969)

### Abstract
arXiv:2506.01969v2 Announce Type: replace 
Abstract: Efficient inference of Multi-Head Latent Attention (MLA) is challenged by deploying the DeepSeek-R1 671B model on a single Multi-GPU server. This paper introduces FlashMLA-ETAP, a novel framework that enhances MLA inference for the single-instance deployment scenario on NVIDIA H20 GPUs. We propose the Efficient Transpose Attention Pipeline (ETAP), which reconfigures attention computation through transposition to align the KV context length with the \(M\)-dimension in WGMMA operations, significantly reducing redundant computations. FlashMLA-ETAP achieves a 2.78x speedup over FlashMLA at 64K sequence length (batch size 16), with 5.24x and 4.94x improvements over FlashAttention-3 and FlashInfer, respectively, while maintaining numerical stability with a 15.2x lower RMSE (\(1.25 \times 10^&#123;-5&#125;\)) than FlashAttention-3. Furthermore, ETAP's design enables seamless integration into frameworks like FlashAttention-3 and FlashInfer, supported by a detailed theoretical analysis. Our work addresses a critical gap in resource-constrained inference, offering a scalable solution for mid-tier GPUs and paving the way for broader adoption in hardware-aware optimization. Code is available at https://github.com/pengcuo/FlashMLA-ETAP.

### 摘要
多头潜在注意力（MLA）的高效推理面临将DeepSeek-R1 671B模型部署在单台多GPU服务器上的挑战。本文提出FlashMLA-ETAP框架，专为NVIDIA H20 GPU单实例部署场景优化MLA推理。我们设计了高效转置注意力流水线（ETAP），通过转置重构注意力计算，使KV上下文长度与WGMMA操作的\(M\)维度对齐，显著减少冗余计算。在64K序列长度（批量大小16）下，FlashMLA-ETAP相较FlashMLA实现2.78倍加速，较FlashAttention-3和FlashInfer分别提升5.24倍和4.94倍，同时保持数值稳定性——其RMSE（\(1.25 \times 10^&#123;-5&#125;\)）比FlashAttention-3低15.2倍。ETAP的设计可无缝集成至FlashAttention-3等框架，并辅以详尽的理论分析。本研究填补了资源受限推理的关键空白，为中端GPU提供可扩展方案，为硬件感知优化开辟更广应用路径。代码详见https://github.com/pengcuo/FlashMLA-ETAP。

---

